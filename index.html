<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investment Comparison Tool</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: Arial, sans-serif;
    }
    #graph-container {
      flex: 3;
      padding: 20px;
    }
    #control-panel {
      flex: 1;
      padding: 20px;
      background-color: #f5f5f5;
      border-left: 1px solid #ccc;
      overflow-y: auto;
    }
    .ticker-row {
      display: flex;
      margin-bottom: 10px;
    }
    .ticker-row input {
      flex: 1;
    }
  </style>
</head>
<body>
  <div id="graph-container">
    <canvas id="investmentChart"></canvas>
  </div>
  <div id="control-panel">
    <label>Starting Investment:<br>
      <input type="number" id="startingInvestment" value="1000">
    </label><br><br>

    <label>Date Start:<br>
      <input type="date" id="startDate">
    </label><br><br>

    <label>Date End:<br>
      <input type="date" id="endDate">
    </label><br><br>

    <div id="tickerInputs">
      <div class="ticker-row">
        <input type="text" class="ticker" value="QQQ" />
      </div>
      <div class="ticker-row">
        <input type="text" class="ticker" placeholder="Enter ticker..." />
      </div>
    </div>
    <button onclick="addTickerRow()">Add Ticker</button>
    <br><br>
    <button onclick="updateGraph()">Update Graph</button>
  </div>

  <script>
    const ctx = document.getElementById('investmentChart').getContext('2d');
    let investmentChart = new Chart(ctx, {
      type: 'line',
      data: { labels: [], datasets: [] },
      options: {
        responsive: true,
        scales: { x: { type: 'time', time: { unit: 'month' } } }
      }
    });

    function addTickerRow() {
      const container = document.getElementById('tickerInputs');
      const div = document.createElement('div');
      div.className = 'ticker-row';
      div.innerHTML = '<input type="text" class="ticker" placeholder="Enter ticker...">';
      container.appendChild(div);
    }

    async function updateGraph() {
      const startingInvestment = parseFloat(document.getElementById('startingInvestment').value);
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      const tickers = Array.from(document.getElementsByClassName('ticker'))
        .map(el => el.value.trim().toUpperCase())
        .filter(t => t);

      const datasets = await Promise.all(tickers.map(async (ticker) => {
        const prices = await fetchStockData(ticker, startDate, endDate);
        if (!prices) return null;

        return {
          label: ticker,
          data: prices.map(p => ({ x: p.date, y: (p.close / prices[0].close) * startingInvestment })),
          borderWidth: 2
        };
      }));

      investmentChart.data.labels = datasets[0]?.data.map(d => d.x) || [];
      investmentChart.data.datasets = datasets.filter(Boolean);
      investmentChart.update();
    }

    async function fetchStockData(ticker, start, end) {
      try {
        const apiKey = 'demo'; // Replace with a real API key
        const url = `https://api.twelvedata.com/time_series?symbol=${ticker}&interval=1day&start_date=${start}&end_date=${end}&apikey=${apiKey}`;
        const res = await fetch(url);
        const data = await res.json();
        if (!data.values) throw new Error('No data');

        return data.values.map(v => ({ date: v.datetime, close: parseFloat(v.close) })).reverse();
      } catch (err) {
        console.error(`Error fetching data for ${ticker}:`, err);
        return null;
      }
    }
  </script>
</body>
</html>
